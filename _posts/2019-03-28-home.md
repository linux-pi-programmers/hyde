---
layout: post
title: Implementing the PI AQM in the Linux Kernel
---

## Introduction

Active Queue Management (AQM) algorithms have taken centerstage in today's Internet age. Routers now have very large buffers that aren't put into good use by standard Passive Queue Management (PQM) algorithms.  

The Proportional Integral (PI) Controller is an AQM algorithm designed using classical control system techniques. The [original paper](https://ieeexplore.ieee.org/abstract/document/916670) also discusses how PI is an improvement over RED (Random Early Detection), another famous AQM. An extension of the PI Controller, PIE (Proportional Integral Extended) was implemented and merged in Linux 3.14.  

Since PIE was already implemented in the linux kernel, we merely had to reporduce the PIE code without the extra bits in PIE. PI uses a different drop probability calculation and has a few other minor modifications.  

## Testbed
![topo](http://linux-pi-programmers.github.io/public/topo.png)

The testbed has two hosts with two routers in between. The hosts have a 100 Mbps bandwidth but the link between the routers have a 10 Mbps bandwidth which is a bottleneck. The testbed is an oversimplification of realworld networks but the bottleneck would allow us to showcase PI's performance against other AQMs.  

There are 12 TCP flows between the two hosts. Flent was used to gather statistics required for testing.

## Analysis 

We compared PI against PIE with the default knobs. 

| Queue Length |
|----|
| ![topo](http://linux-pi-programmers.github.io/public/pi-qlen-plot.png)  |  
| ![topo](http://linux-pi-programmers.github.io/public/pie-qlen-plot.png) |
  
| Bandwidth and Ping |
|----|
|  ![topo](http://linux-pi-programmers.github.io/public/pi-bandwidth-plot.png)  |
|  ![topo](http://linux-pi-programmers.github.io/public/pie-bandwidth-plot.png) |
